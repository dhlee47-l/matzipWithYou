<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Page</title>
    <script>
        // JavaScript
        document.addEventListener('DOMContentLoaded', function () {
            const memberId = [[${memberId}]];

            const updateNicknameForm = document.getElementById('updateNicknameForm');
            const messageContainer = document.getElementById('messageContainer');
            const myPageContainer = document.getElementById('myPageContainer');

            updateNicknameForm.addEventListener('submit', function (event) {
                event.preventDefault(); // 기본 폼 동작 방지

                const newNickname = document.getElementById('newNickname').value;

                // 닉네임 변경 요청
                fetch(`/members/${memberId}`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ newNickname })
                })
                    .then(response => response.json())
                    .then(data => {
                        // 응답 메시지를 표시
                        if (data.error) {
                            messageContainer.innerText = `Error: ${data.error}`;
                            messageContainer.style.color = 'red';
                        } else {
                            messageContainer.innerText = data.message;
                            messageContainer.style.color = 'green';

                            // 마이페이지 정보 갱신
                            if (data.myPage) {
                                const { nickname, friendCnt, point, profileImage } = data.myPage;

                                // 화면에 갱신된 정보 반영
                                myPageContainer.innerHTML = `
                                    <p><strong>닉네임:</strong> ${nickname}</p>
                                    <p><strong>친구 수:</strong> ${friendCnt}</p>
                                    <p><strong>포인트:</strong> ${point}</p>
                                    <p><strong>프로필 이미지:</strong> <img src="${profileImage}" alt="프로필 이미지" width="100" /></p>
                                `;
                            }
                        }
                    })
                    .catch(error => {
                        messageContainer.innerText = `Error: ${error}`;
                        messageContainer.style.color = 'red';
                    });
            });
        });
    </script>
</head>
<body>
<h1>My Page</h1>

<div id="myPageContainer">
    <!-- 서버에서 렌더링된 기본 마이페이지 정보를 여기에 표시 -->
    <p><strong>닉네임:</strong> 현재 닉네임</p>
    <p><strong>친구 수:</strong> 10</p>
    <p><strong>포인트:</strong> 10000</p>
    <p><strong>프로필 이미지:</strong> <img src="/static/IMG/star-gray.svg" alt="프로필 이미지" width="100" /></p>
</div>

<h2>닉네임 변경</h2>
<form id="updateNicknameForm">
    <label for="newNickname">새 닉네임:</label>
    <input type="text" id="newNickname" name="newNickname" required maxlength="20">
    <button type="submit">변경</button>
</form>

<div id="messageContainer" style="margin-top: 10px; font-weight: bold;">
    <!-- 서버 응답 메시지가 여기에 표시됩니다. -->
</div>
</body>
</html>



<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>My Page</title>-->
<!--    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">-->

<!--    <script th:inline="javascript">-->
<!--        console.log([[${myPage}]])-->
<!--    </script>-->
<!--</head>-->
<!--<body>-->
<!--<div class="container mt-5">-->
<!--    <div class="row">-->
<!--        &lt;!&ndash; Profile Section &ndash;&gt;-->
<!--        <div class="col-md-4 text-center">-->
<!--            <img id="profileImage" src="" alt="Profile Image" class="rounded-circle" style="width: 150px; height: 150px;">-->
<!--            <h3 id="nickname" class="mt-3">Nickname</h3>-->
<!--            <button class="btn btn-primary mt-2" onclick="updateNickname()">Edit Nickname</button>-->
<!--        </div>-->

<!--        &lt;!&ndash; Stats Section &ndash;&gt;-->
<!--        <div class="col-md-8">-->
<!--            <div class="card mb-3">-->
<!--                <div class="card-body">-->
<!--                    <h5>Statistics</h5>-->
<!--                    <p>Friends: <span id="friendCnt">0</span></p>-->
<!--                    <p>Points: <span id="point">0</span></p>-->
<!--                </div>-->
<!--            </div>-->

<!--            &lt;!&ndash; Wishlist Section &ndash;&gt;-->
<!--            <div class="card mb-3">-->
<!--                <div class="card-body">-->
<!--                    <h5>Wishlist (<span id="wishCnt">0</span>)</h5>-->
<!--                    <div id="wishlistPreview" class="row g-2">-->
<!--                        &lt;!&ndash; Wishlist items will be appended here &ndash;&gt;-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->

<!--            &lt;!&ndash; My Matzip Section &ndash;&gt;-->
<!--            <div class="card mb-3">-->
<!--                <div class="card-body">-->
<!--                    <h5>My Matzip (<span id="myMatzipCnt">0</span>)</h5>-->
<!--                    <div id="myMatzipPreview" class="row g-2">-->
<!--                        &lt;!&ndash; My matzip items will be appended here &ndash;&gt;-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->

<!--            &lt;!&ndash; My Reviews Section &ndash;&gt;-->
<!--            <div class="card">-->
<!--                <div class="card-body">-->
<!--                    <h5>My Reviews (<span id="myReviewCnt">0</span>)</h5>-->
<!--                    <div id="myReviewPreview">-->
<!--                        &lt;!&ndash; Review items will be appended here &ndash;&gt;-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->
