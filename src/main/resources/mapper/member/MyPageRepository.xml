<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lec.spring.member.repository.MyPageRepository">

<!-- 닉네임, 친구수, 포인트 -->
    <select id="myProfile">
        SELECT
            m.nickname,
            (
                SELECT COUNT(*)
                FROM friend f
                WHERE (f.sender_id = m.id OR f.receiver_id = m.id)
                  AND f.is_accept = true
            ) AS my_friends,
            m.point
        FROM
            member m
        WHERE
            m.id = #{memberId}
    </select>

    <!-- 닉네임 수정 -->
    <update id="updateNick">
        UPDATE member
        SET nickname = #{newNick}
        WHERE id = #{memberId}
    </update>



<!-- 위시리스트, 내맛집, 내리뷰 개수 -->
    <select id="myActsCount">
        SELECT
            (SELECT COUNT(*)
            FROM wish_list w WHERE member_id = #{memberId}) 위시리스트,
            (SELECT COUNT(*)
             FROM my_matzip WHERE member_id = #{memberId}) 나의맛집,
            (SELECT COUNT(*)
             FROM my_review WHERE member_id = #{memberId}) 나의리뷰
        FROM member m
        WHERE m.id = #{memberId};
    </select>

    <!-- 위시 미리보기 -->
    <select id="wishContents">
        SELECT mz.name, mz.img_url
        FROM wish_list w, matzip mz
        WHERE w.matzip_id = mz.id and w.member_id = #{memberId}
    </select>


    <!-- 내맛집 미리보기 -->
    <select id="myMatzipContents">
        SELECT mz.name, mz.img_url
        FROM my_matzip mm, matzip mz
        WHERE mm.matzip_id = mz.id and mm.member_id = #{memberId}
    </select>


    <!-- 내리뷰 미리보기 -->
    <select id="myReviewContents">
        SELECT mr.member_id, mr.star_rating, mz.name, mr.content
        FROM my_review mr, matzip mz
        WHERE mr.matzip_id = mz.id and mr.member_id = #{memberId}
    </select>



</mapper>